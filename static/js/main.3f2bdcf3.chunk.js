(this["webpackJsonpreact-chat"]=this["webpackJsonpreact-chat"]||[]).push([[0],{173:function(e,a,t){e.exports=t(195)},190:function(e,a,t){},195:function(e,a,t){"use strict";t.r(a);var n=t(151),r=t(152),c=t(160),l=t(159),s=t(0),o=t.n(s),i=t(42),u=t.n(i),m=t(43),d=t(222),f=t(217),h=t(212),g=t(208),p=t(197);var E=function(){return o.a.createElement(f.a,{as:h.a,icon:"labeled",inverted:!0,vertical:!0,visible:!0,width:"very thin"},o.a.createElement(g.a,null),o.a.createElement(p.a,{icon:"add",size:"small",color:"blue"}))},b=t(9),v=t(11),O=t(220),C=t(214),j=t(221),y=t(66),w=t(209);var S=function(e){var a=e.channelName,t=e.numUniqueUsers,n=e.handleSearchChange,r=e.isPrivateChannel;return o.a.createElement(O.a,{clearing:!0},o.a.createElement(j.a,{fluid:"true",as:"h2",floated:"left",style:{marginBottom:0}},o.a.createElement("span",null,a,r?"":o.a.createElement(y.a,{name:"star outline",color:"black"})),o.a.createElement(j.a.Subheader,null,t)),o.a.createElement(j.a,{floated:"right"},o.a.createElement(w.a,{onChange:n,size:"mini",icon:"search",name:"searchTerm",placeholder:"Search Messages"})))},N=t(16),R=t(136),U=t.n(R);t(183),t(185),t(196);U.a.initializeApp({apiKey:"AIzaSyCWd5JLW5gswBI0dNvp57yaQi9bUZ-1lk0",authDomain:"react-chat-cafbf.firebaseapp.com",databaseURL:"https://react-chat-cafbf.firebaseio.com",projectId:"react-chat-cafbf",storageBucket:"react-chat-cafbf.appspot.com",messagingSenderId:"423589169785",appId:"1:423589169785:web:a6647c42f48f1b8384a2a8",measurementId:"G-2KXMB5P97F"});var A=U.a;var _=function(e){var a=Object(s.useState)({storageRef:A.storage().ref(),uploadState:"",uploadTask:null,percentUploaded:0,messages:"",channel:e.currentChannel,user:e.currentUser,getMessagesRef:e.getMessagesRef,loading:!1,errors:[]}),t=Object(v.a)(a,2),n=t[0],r=t[1];return Object(s.useEffect)((function(){}),[n]),o.a.createElement(O.a,{className:"messages__form"},o.a.createElement(w.a,{fluid:!0,name:"messages",style:{marginBottom:"0.7em"},label:o.a.createElement(p.a,{icon:"add"}),labelPosition:"left",placeholder:"Write your message",value:n.messages,onChange:function(e){var a=e.target,t=a.value,c=a.name;r(Object(b.a)(Object(b.a)({},n),{},Object(N.a)({},c,t)))}}),o.a.createElement(p.a.Group,{icon:!0,widths:"2"},o.a.createElement(p.a,{color:"orange",content:"Add Reply",labelPosition:"left",icon:"edit",disabled:n.loading,onClick:function(){var a=e.currentChannel;n.messages?n.getMessagesRef().child(a.id).push().set(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,a={timestamp:A.database.ServerValue.TIMESTAMP,user:{id:n.user.uid,name:n.user.displayName,avatar:n.user.photoURL},content:n.messages};return null!==e?a.image=e:a.content=n.messages,a}()).then((function(){r(Object(b.a)(Object(b.a)({},n),{},{loading:!1,messages:""}))})).catch((function(e){console.log(e),r(Object(b.a)(Object(b.a)({},n),{},{loading:!1}))})):console.log(2)}})))},L=t(156),k=t.n(L),P=t(161),T=function(e){var a,t=e.message;return o.a.createElement(C.a,null,o.a.createElement(C.a.Avatar,{src:t.user.avatar}),o.a.createElement(C.a.Content,{className:"message__self"},o.a.createElement(C.a.Author,{as:"a"},t.user.name),o.a.createElement(C.a.Metadata,null,(a=t.timestamp,k()(a).fromNow())),function(e){return e.hasOwnProperty("image")&&!e.hasOwnProperty("content")}(t)?o.a.createElement(P.a,{src:t.image,className:"message_image"}):o.a.createElement(C.a.Text,null,t.content)))};var I=function(e){var a=e.currentChannel,t=e.currentUser,n=e.isPrivateChannel,r=Object(s.useState)(""),c=Object(v.a)(r,2),l=c[0],i=c[1],u=Object(s.useState)(""),m=Object(v.a)(u,2),d=m[0],f=m[1],h=Object(s.useState)([]),g=Object(v.a)(h,2),p=g[0],E=g[1],j=Object(s.useState)(A.database().ref("privateMessages")),y=Object(v.a)(j,1)[0],w=Object(s.useState)({messagesRef:A.database().ref("messages"),messagesList:[],messagesLoading:!0}),N=Object(v.a)(w,2),R=N[0],U=N[1],L=function(e){var a=[];P().child(e).on("child_added",(function(e){a.push(e.val()),U(Object(b.a)(Object(b.a)({},R),{},{messagesList:a,messagesLoading:!1}))})),k(a)},k=function(e){var a=e.reduce((function(e,a){return e.includes(a.user.name)||e.push(a.user.name),e}),[]),t=a.length>1||0===a.length,n="".concat(a.length," user").concat(t?"s":"");i(n)},P=function(){return n?y:R.messagesRef},I=function(){var e=R.messagesList,a=new RegExp(d,"gi"),t=e.reduce((function(e,t){return(t.content&&t.content.match(a)||t.user.name.match(a))&&e.push(t),e}),[]);E(t)};return Object(s.useEffect)((function(){t&&a&&L(a.id)}),[]),o.a.createElement("div",null,o.a.createElement(S,{numUniqueUsers:l,handleSearchChange:function(e){f(e.target.value),I()},channelName:function(e){return e?"".concat(n?"@":"#"," ").concat(e.name):""}(a),isPrivateChannel:n}),o.a.createElement(O.a,null,o.a.createElement(C.a.Group,{className:"messages"},d?p.map((function(e){return o.a.createElement(T,{key:e.timestamp,message:e})})):R.messagesList.map((function(e){return o.a.createElement(T,{key:e.timestamp,message:e})})))),o.a.createElement(_,{messagesRef:R.messagesRef,currentChannel:a,currentUser:t,isPrivateChannel:n,getMessagesRef:P}))},M=t(211);var x=function(e){var a=e.currentUser.currentUser;return o.a.createElement(d.a,{style:{background:"#4c3c4c"}},o.a.createElement(d.a.Column,{style:{textAlign:"center",marginTop:10}},o.a.createElement(d.a.Row,null,o.a.createElement(j.a,{inverted:!0,as:"h2"},o.a.createElement(j.a.Content,null,"React Chat")),o.a.createElement(P.a,{src:a.photoURL,spaced:"right",avatar:!0}),o.a.createElement(M.a,{text:a.displayName,floating:!0,labeled:!0,className:"icon",style:{color:"white"}},o.a.createElement(M.a.Menu,null,o.a.createElement(M.a.Item,null,"Signed in as"),o.a.createElement(M.a.Item,null,"Change Avatar"),o.a.createElement(M.a.Item,{onClick:function(){A.auth().signOut()}},"Sign Out"))))))},q=t(215),z=t(213),W=t(81),B=function(e){return{type:"SET_CURRENT_CHANNEL",payload:{currentChannel:e}}},D=function(e){return{type:"SET_PRIVATE_CHANNEL",payload:{isPrivateChannel:e}}};var Z=Object(m.b)(null,{setCurrentChannel:B,setPrivateChannel:D})((function(e){var a=e.currentUser.currentUser.currentUser,t=Object(W.a)(),n=t.handleSubmit,r=t.register,c=Object(s.useState)(!1),l=Object(v.a)(c,2),i=l[0],u=l[1],m=Object(s.useState)({activeChannel:"",channels:[],channelname:"",channeldetails:"",channelsRef:A.database().ref("channels"),firstLoad:!0}),d=Object(v.a)(m,2),f=d[0],g=d[1],E=function(){return u(!1)},O=function(a){var t=a[0];f.firstLoad&&a.length>0&&e.setCurrentChannel(t),g({firstLoad:!1,channels:a})},C=function(e){var a=e.target,t=a.value,n=a.name;g(Object(b.a)(Object(b.a)({},f),{},Object(N.a)({},n,t)))},j=function(e){console.log(e),g(Object(b.a)(Object(b.a)({},f),{},{activeChannel:e.id}))};return Object(s.useEffect)((function(){var e=[];f.channelsRef.on("child_added",(function(a){e.push(a.val()),O(e),g(Object(b.a)(Object(b.a)({},f),{},{channels:e}))}))}),[]),o.a.createElement("div",null,o.a.createElement(h.a.Menu,{className:"menu"},o.a.createElement(h.a.Item,null,o.a.createElement("span",null,o.a.createElement(y.a,{name:"exchange"}),"CHANNELS"),"(",f.channels.length,")",o.a.createElement(y.a,{name:"add",onClick:function(){return u(!0)}})),f.channels.map((function(a){return o.a.createElement(h.a.Item,{onClick:function(){return function(a){j(a),e.setCurrentChannel(a),e.setPrivateChannel(!1)}(a)},key:a.id,name:a.name,style:{opacity:.7},active:a.id===f.activeChannel},"# ",a.name)}))),o.a.createElement(q.a,{basic:!0,open:i,onClose:E},o.a.createElement(q.a.Header,null,"Add a Channel"),o.a.createElement(q.a.Content,null,o.a.createElement(z.a,{onSubmit:n((function(e){console.log(e);var t=f.channelsRef.push().key;console.log(t);var n={id:t,name:e.channelname,details:e.channeldetails,createdBy:{name:a.displayName,avatar:a.photoURL}};f.channelsRef.child(t).update(n).then((function(){u(!1),console.log("channel added")})).catch((function(e){console.log(e)}))}))},o.a.createElement(z.a.Field,null,o.a.createElement("input",{placeholder:"Name of Channel",name:"channelname",onChange:C,ref:r({required:!0})})),o.a.createElement(z.a.Field,null,o.a.createElement("input",{placeholder:"About the Channel",name:"channeldetails",onChange:C,ref:r({required:!0})})),o.a.createElement(p.a,{color:"green",inverted:!0,type:"Submit"},o.a.createElement(y.a,{name:"checkmark"}),"Add"),o.a.createElement(p.a,{color:"red",inverted:!0,onClick:E},o.a.createElement(y.a,{name:"remove"}),"Cancel")))))}));var H=Object(m.b)(null,{setCurrentChannel:B,setPrivateChannel:D})((function(e){var a=e.currentUser.currentUser,t=Object(s.useState)(""),n=Object(v.a)(t,2),r=n[0],c=n[1],l=Object(s.useState)({users:[],usersRef:A.database().ref("users"),connectedRef:A.database().ref(".info/connected"),presenceRef:A.database().ref("presence")}),i=Object(v.a)(l,2),u=i[0],m=i[1],d=function(e){var a=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],t=u.users.reduce((function(t,n){return n.uid===e&&(n.status="".concat(a?"online":"offline")),t.concat(n)}),[]);m(Object(b.a)(Object(b.a)({},u),{},{users:t}))},f=function(e){return"online"===e.status},g=function(e){return e};return Object(s.useEffect)((function(){a&&function(e){var a=[];u.usersRef.on("child_added",(function(t){if(e!==t.key){var n=t.val();n.uid=t.key,n.status="offline",a.push(n),m(Object(b.a)(Object(b.a)({},u),{},{users:a}))}})),u.connectedRef.on("value",(function(a){if(!0===a.val()){var t=u.presenceRef.child(e);t.set(!0),t.onDisconnect().remove((function(e){null!==e&&console.log(e)}))}})),u.presenceRef.on("child_added",(function(a){e!==a.key&&d(a.key)})),u.presenceRef.on("child_moved",(function(a){e!==a.key&&d(a.key,!1)}))}(a.uid)}),[]),o.a.createElement(h.a.Menu,{className:"menu"},o.a.createElement(h.a.Item,null,o.a.createElement("span",null,o.a.createElement(y.a,{name:"mail"})," DIRECT MESSAGES"),"","(",u.users.length,")"),u.users.map((function(a){return o.a.createElement(h.a.Item,{key:a.uid,active:a.uid===r,onClick:function(){return function(a){var t={id:g(a.uid),name:a.name};console.log(t),e.setCurrentChannel(t),e.setPrivateChannel(!0),c(a.uid)}(a)},style:{opacity:.7,fontStyle:"italic"}},o.a.createElement(y.a,{name:"circle",color:f(a)?"green":"red"}),"@ ",a.name)})))}));var Y=function(e){return o.a.createElement(h.a,{size:"large",inverted:!0,fixed:"left",vertical:!0,style:{background:"#4c3c4c",fontSize:"1.2rem"}},o.a.createElement(x,{currentUser:e}),o.a.createElement(Z,{currentUser:e}),o.a.createElement(H,{currentUser:e}))};var V=function(){return o.a.createElement("div",{className:"App"},"MetaPanel")},X=(t(190),Object(m.b)((function(e){return{currentUser:e.user.currentUser,currentChannel:e.channel.currentChannel,isPrivateChannel:e.channel.isPrivateChannel}}))((function(e){var a=e.currentUser,t=e.currentChannel,n=e.isPrivateChannel;return o.a.createElement("div",{className:"App"},o.a.createElement(d.a,{columns:"equal",className:"app",style:{background:"#eee"}},o.a.createElement(E,null),o.a.createElement(Y,{key:a&&a.uid,currentUser:a}),o.a.createElement(d.a.Column,{style:{marginLeft:320}},o.a.createElement(I,{key:t&&t.id,currentChannel:t,currentUser:a,isPrivateChannel:n})),o.a.createElement(d.a.Column,{width:4},o.a.createElement(V,null))))}))),F=t(79),G=t(216);var J=function(){var e=Object(W.a)(),a=e.register,t=e.handleSubmit,n=e.errors,r=Object(s.useState)(!1),c=Object(v.a)(r,2),l=c[0],i=c[1],u=Object(s.useState)({email:"",password:"",loading:!1,messageTitle:"",messageInfo:"",usersRef:A.database().ref("users")}),m=Object(v.a)(u,2),f=m[0],h=m[1],g=function(e){var a=e.target,t=a.value,n=a.name;h(Object(b.a)(Object(b.a)({},f),{},Object(N.a)({},n,t))),console.log(f)};return o.a.createElement(d.a,{textAlign:"center",verticalAlign:"middle",className:"app"},o.a.createElement(d.a.Column,{style:{maxWidth:450}},o.a.createElement(j.a,{as:"h2",icon:!0,color:"blue",textAlign:"center"},"Chat App Login"),o.a.createElement(z.a,{onSubmit:t((function(e){console.log(e),h({loading:!0}),A.auth().signInWithEmailAndPassword(e.email,e.password).then((function(e){console.log(1),console.log(e)})).catch((function(e){console.log(2),console.log(e),h({loading:!1,messageInfo:e.message,messageTitle:"Error"}),i(!0)}))}))},o.a.createElement(O.a,null,o.a.createElement("div",{className:n.email?"field error":"field"},o.a.createElement("input",{name:"email",placeholder:"Email",type:"email",ref:a({required:"You must specify a Email",pattern:{value:/^[A-Z0-9._%+-]+@[A-Z0-9.-]+\.[A-Z]{2,4}$/i}}),onChange:g}),o.a.createElement("span",{className:"error"},n.email&&n.email.message)),o.a.createElement("div",{className:n.password?"field error":"field"},o.a.createElement("input",{name:"password",placeholder:"Password",type:"password",ref:a({required:"You must specify a password"}),onChange:g}),o.a.createElement("span",{className:"error"},n.password&&n.password.message)),o.a.createElement(p.a,{type:"submit",color:"blue",size:"large",disabled:f.loading,className:f.loading?"loading":""},"Submit"))),l?o.a.createElement(G.a,{error:!0},o.a.createElement("h3",null,f.messageTitle),o.a.createElement("span",null,f.messageInfo)):"",o.a.createElement(G.a,null,o.a.createElement(F.b,{to:"/register"},"Sign up"))))},$=t(12),K=t(157),Q=t.n(K);var ee=function(){var e=Object(W.a)(),a=e.register,t=e.handleSubmit,n=e.errors,r=e.watch,c=Object(s.useState)(!1),l=Object(v.a)(c,2),i=l[0],u=l[1],m=r("password"),f=Object($.f)(),h=Object(s.useState)({username:"",email:"",password:"",passwordconfirmation:"",loading:!1,messageTitle:"",messageInfo:"",usersRef:A.database().ref("users")}),g=Object(v.a)(h,2),E=g[0],C=g[1],y=function(e){var a=e.target,t=a.value,n=a.name;C(Object(b.a)(Object(b.a)({},E),{},Object(N.a)({},n,t))),console.log(E)};return o.a.createElement(d.a,{textAlign:"center",verticalAlign:"middle",className:"app"},o.a.createElement(d.a.Column,{style:{maxWidth:450}},o.a.createElement(j.a,{as:"h2",icon:!0,color:"blue",textAlign:"center"},"Chat App Register"),o.a.createElement(z.a,{onSubmit:t((function(e){console.log(e),C({loading:!0}),A.auth().createUserWithEmailAndPassword(e.email,e.password).then((function(a){console.log(a),a.user.updateProfile({displayName:e.email,photoURL:"http://gravatar.com/avatar/".concat(Q()(a.user.email),"?d=identicon")}).then((function(){(function(e){return E.usersRef.child(e.user.uid).set({name:e.user.displayName,avatar:e.user.photoURL})})(a).then((function(){console.log("user saved")})),C({loading:!1}),u(!1),f.push("/login")})).catch((function(e){console.log(e),C({loading:!1})}))})).catch((function(e){C({loading:!1,messageInfo:e.message,messageTitle:"Error"}),u(!0)}))}))},o.a.createElement(O.a,null,o.a.createElement("div",{className:n.username?"field error":"field"},o.a.createElement("input",{name:"username",placeholder:"Username",type:"text",ref:a({required:"You must specify a Username"}),onChange:y}),o.a.createElement("span",{className:"error"},n.username&&n.username.message)),o.a.createElement("div",{className:n.email?"field error":"field"},o.a.createElement("input",{name:"email",placeholder:"Email",type:"email",ref:a({required:"You must specify a Email",pattern:{value:/^[A-Z0-9._%+-]+@[A-Z0-9.-]+\.[A-Z]{2,4}$/i}}),onChange:y}),o.a.createElement("span",{className:"error"},n.email&&n.email.message)),o.a.createElement("div",{className:n.password?"field error":"field"},o.a.createElement("input",{name:"password",placeholder:"Password",type:"password",ref:a({required:"You must specify a password"}),onChange:y}),o.a.createElement("span",{className:"error"},n.password&&n.password.message)),o.a.createElement("div",{className:n.passwordconfirmation?"field error":"field"},o.a.createElement("input",{name:"passwordconfirmation",placeholder:"Password Confirmation",type:"password",ref:a({required:"You must specify a password",validate:function(e){return e===m||"The passwords do not match"}}),onChange:y}),o.a.createElement("span",{className:"error"},n.passwordconfirmation&&n.passwordconfirmation.message)),o.a.createElement(p.a,{type:"submit",color:"blue",size:"large",disabled:E.loading,className:E.loading?"loading":""},"Submit"))),i?o.a.createElement(G.a,{error:!0},o.a.createElement("h3",null,E.messageTitle),o.a.createElement("span",null,E.messageInfo)):"",o.a.createElement(G.a,null,o.a.createElement("span",null,"Already a user? "),o.a.createElement(F.b,{to:"/login"},"Login"))))},ae=t(219),te=t(210),ne=function(){return o.a.createElement(ae.a,{active:!0},o.a.createElement(te.a,{size:"huge",content:"Loading"}))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));t(194);var re=t(158),ce=t(54),le={currentUser:null,isLoading:!0},se={currentChannel:null,isPrivateChannel:!1},oe=Object(ce.c)({user:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:le,a=arguments.length>1?arguments[1]:void 0;switch(a.type){case"SET_USER":return{currentUser:a.payload.currentUser,isLoading:!1};case"CLEAR_USER":return Object(b.a)(Object(b.a)({},e),{},{isLoading:!1});default:return e}},channel:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:se,a=arguments.length>1?arguments[1]:void 0;switch(a.type){case"SET_CURRENT_CHANNEL":return Object(b.a)(Object(b.a)({},e),{},{currentChannel:a.payload.currentChannel});case"SET_PRIVATE_CHANNEL":return Object(b.a)(Object(b.a)({},e),{},{isPrivateChannel:a.payload.isPrivateChannel});default:return e}}}),ie=Object(ce.d)(Object(ce.a)(re.a),window.__REDUX_DEVTOOLS_EXTENSION__&&window.__REDUX_DEVTOOLS_EXTENSION__()),ue=Object(ce.e)(oe,ie),me=function(e){Object(c.a)(t,e);var a=Object(l.a)(t);function t(){return Object(n.a)(this,t),a.apply(this,arguments)}return Object(r.a)(t,[{key:"componentDidMount",value:function(){var e=this;A.auth().onAuthStateChanged((function(a){a?(e.props.setUser(a),e.props.history.push("/")):(e.props.history.push("/login"),e.props.clearUser())}))}},{key:"render",value:function(){return this.props.isLoading?o.a.createElement(ne,null):o.a.createElement($.c,null,o.a.createElement($.a,{exact:!0,path:"/",component:X}),o.a.createElement($.a,{path:"/register",component:ee}),o.a.createElement($.a,{path:"/login",component:J}))}}]),t}(s.Component),de=Object($.g)(Object(m.b)((function(e){return{isLoading:e.user.isLoading}}),{setUser:function(e){return{type:"SET_USER",payload:{currentUser:e}}},clearUser:function(){return{type:"CLEAR_USER"}}})(me));u.a.render(o.a.createElement(o.a.Fragment,null,o.a.createElement(m.a,{store:ue},o.a.createElement(F.a,null,o.a.createElement(de,null)))),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[173,1,2]]]);
//# sourceMappingURL=main.3f2bdcf3.chunk.js.map